<link href="{{ url_for('static', filename='table.css') }}" rel="stylesheet" type="text/css" />
<link href="{{ url_for('static', filename='form.css') }}" rel="stylesheet" type="text/css" />
<link href="{{ url_for('static', filename='modal.css') }}" rel="stylesheet" type="text/css" />

{% include 'header.html' %}

<style>
  input[type=text],
  input[type=date],
  input[type=checkbox],
  textarea,
  select
  {
      border: 1px solid lightgrey;
      border-radius: 5px;
  }
</style>

<title>Soins</title>

<!-- The Modal -->
<div id="add_modal" class="modal">
  <div class="modal-content">
    <span class="add_close">&times;</span>
    <h2>Création d'un nouveau soin</h2>
    <form class="form-style" action="/cares" method="post">
      <fieldset>
	<legend>Nouveau soin</legend>
	<label for="type">Type</label>
	<input type="text" name="type" required>
	<label for="name">Nom</label>
	<input type="text" name="name">
	<label for="dose">Dose</label>
	<input name="dose" type="text">
	<label for="way">Administration</label>
	<input type="text" name="way">
	<label for="desc">Description</label>
	<textarea name="desc"></textarea>
	<button class="submit" type="submit" value="submit">Valider</button>
      </fieldset>
    </form>
  </div>
</div>

<h1>Liste des soins</h1>
<p>
  <table id="table">

    <tr><th>Nom du médicament</th><th>Type</th><th>Dose</th>
      <th>Administration</th><th>Description</th>
      <th>
	<button class="btn-emoji" id="add_btn" type="button">
	  <i class="fa fa-plus fa-2x" aria-hidden="true"></i>
	</button>
      </th>
    </tr>

    {% for care in cares %}
    <tr id="tr-{{ care.id }}">
      <td style="display:none;">{{ care.id }}</td>
      <td id="td-name">{{ care.medecine_name }}</td>
      <td id="td-type">{{ care.type }}</td>
      <td id="td-dose">{{ care.dose }}</td>
      <td id="td-way">{{ care.way }}</td>
      <td id="td-desc">{{ care.description }}</td>
      <td>
	<button class="btn-emoji" id="edit_btn{{ care.id }}" type="button" onclick="edit_popup()" value={{care.id}}>
	  <i class="fa fa-pencil fa-2x" aria-hidden="true"></i></button>
	<form id="form_del" action="/cares" method="post">
	  <input type="hidden" id="id_del" name="id_del" value="None"/>
	  <button class="btn-emoji" id="del_btn" type="submit">
	    <i class="fa fa-trash fa-2x" aria-hidden="true"></i></button>
	</form>
      </td>
    </tr>
    {% endfor %}
  </table>

</p>

<script>

  $('#table').on('click', '#add_btn', function() {
      var amodal = document.getElementById("add_modal");
      var aspan = document.getElementsByClassName("add_close")[0];
      amodal.style.display = "block";
      aspan.onclick = function() {
	  amodal.style.display = "none";
      }
  });

  $('#table').on('click', '#del_btn', function() {
      if ( confirm("Etes-vous sûr de vouloir supprimer cette ligne?") == true ) {
	  $(this).parents('tr').detach();
	  var id_to_del = $(this).parents('tr').find('td:first').text();
	  document.getElementById("id_del").setAttribute('value', id_to_del);
	  document.getElementById("form_del").submit();
      }
  });

  // Get the modal
  var modal = document.getElementById("modal");
  // Get the button that opens the modal
  var btn = document.getElementById("modal-btn");
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];
  // When the user clicks the button, open the modal
  btn.onclick = function() {
      modal.style.display = "block";
  }
  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
      modal.style.display = "none";
  }
  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
      if (event.target == modal) {
	  modal.style.display = "none";
      }
  }

</script>
